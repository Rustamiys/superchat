<div class="container">
  <div class="chat-list">
    <div class="messages-header" *ngIf="user$ | async as user; else noMessages">
      <h2>{{ user.name }} {{ user.surename }}</h2>
    </div>
      <mat-selection-list *ngIf="myChats$ | async as myChats; else loading" [multiple]="false" [formControl]="chatListControl">
        <mat-list-option *ngFor="let chat of myChats" [value]="chat.login" (click)="$event.stopPropagation(); select(chat.login)">
          <p mat-line class="chat-title">
            <span class="chat-name">{{ chat.surename }}</span>
            <span class="chat-login">{{ chat.login }}</span>
            <span class="chat-name">{{ chat.name }}</span>
          </p>
          <mat-divider></mat-divider>
        </mat-list-option>
      </mat-selection-list>
      <ng-template #loading>
        <p>Загрузка данных...</p>
      </ng-template>
  </div>
  <div class="messages">
      <div class="messages-header" *ngIf="selectedChat$ else noMessages">
        <h2>{{ selectedChat$.name }} {{selectedChat$.surename}}</h2>
      </div>
      <ng-template #noMessages>
        <div class="messages-header">
          <h2>Messages</h2>
        </div>
      </ng-template>
      <mat-divider></mat-divider>
      <div class="chat-area">
        <ng-container>
          <div *ngFor="let message of chat"
              class="chat-bubble-container"
              [ngClass]="{ 'sender': message.senderId === user_id }">
            <div *ngIf="message.senderId === user_id" class="chat-bubble-self">
              {{ message.text }}
              <br>
              <span class="chat-date">
                {{ message.senderId }} 
                {{ message.sentDate | date: 'dd.MM.yyyy, HH:mm:ss' }}
            </span>
            </div>
            <div *ngIf="message.senderId !== user_id" class="chat-bubble-sender">
              {{ message.text }}
              <br>
              <span class="chat-date">
                {{ message.senderId }} 
                {{ message.sentDate | date: 'dd.MM.yyyy, HH:mm:ss' }}
              </span>
            </div>
        </div>     
        </ng-container>
        <div #endOfChat></div>

      </div>
      <div class="input-area">
        <mat-form-field appearance="outline">
          <input [formControl]= "messageControl" matInput placeholder="Введите ваше сообщение..."
                 (keydown.enter)="sendMessage()"/>
        </mat-form-field>
        <button mat-icon-button matSuffix (click)="sendMessage()">
            <mat-icon>send</mat-icon>
          </button>
      </div>
  </div>
</div>